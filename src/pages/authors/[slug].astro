---
import Layout from '../../layouts/Layout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const authors = await getCollection('authors');
  return authors.map((author) => ({
    params: { slug: author.id },
    props: { author },
  }));
}

const { author } = Astro.props;
const { Content } = await render(author);

// Get seeds by this author (match by author slug, not name)
const seeds = await getCollection('seeds');
const authorSeeds = seeds.filter(seed => seed.data.author === author.id);
---

<Layout title={`${author.data.name} - Dreamseed`}>
	<div class="max-w-4xl mx-auto p-4">
		<div class="mb-8">
			<div class="flex items-center mb-4">
				{author.data.avatar && (
					<img src={author.data.avatar} alt={author.data.name} class="w-16 h-16 mr-4" />
				)}
				<div>
					<h1 class="text-2xl font-bold mb-2">
						{author.data.name}
					</h1>
					<p>
						{author.data.bio}
					</p>
				</div>
			</div>
			
			<div class="flex items-center space-x-4 text-sm mb-4">
				<span>Joined {author.data.joinedAt.toLocaleDateString()}</span>
				<div class="space-x-2">
					{author.data.website && (
						<a href={author.data.website} class="hover:underline" target="_blank" rel="noopener noreferrer">
							Website
						</a>
					)}
					{author.data.twitter && (
						<a href={`https://twitter.com/${author.data.twitter}`} class="hover:underline" target="_blank" rel="noopener noreferrer">
							Twitter
						</a>
					)}
					{author.data.github && (
						<a href={`https://github.com/${author.data.github}`} class="hover:underline" target="_blank" rel="noopener noreferrer">
							GitHub
						</a>
					)}
				</div>
			</div>
		</div>
		
		<div class="mb-8">
			<Content />
		</div>
		
		{authorSeeds.length > 0 && (
			<div class="mb-8">
				<h2 class="text-xl font-bold mb-4">Seeds by {author.data.name}</h2>
				<div class="grid gap-4 md:grid-cols-2">
					{authorSeeds.map((seed) => (
						<a href={`/seeds/${seed.id}`} class="block">
							<div class="border p-4 hover:bg-gray-50">
								<h3 class="font-bold mb-2">{seed.data.title}</h3>
								<p class="text-sm">{seed.data.description}</p>
								<div class="mt-2 text-xs">
									{seed.data.publishedAt.toLocaleDateString()}
								</div>
							</div>
						</a>
					))}
				</div>
			</div>
		)}
		
		<div class="border-t pt-4">
			<a href="/authors" class="hover:underline">
				‚Üê Back to all authors
			</a>
		</div>
	</div>
</Layout>